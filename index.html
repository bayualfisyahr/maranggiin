<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dasbor Bisnis Sate Maranggi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .content-section { display: none; }
    .content-section.active { display: block; }
    .sidebar-link.active { background-color: #f59e0b; color: white; }
    #sidebar-overlay { transition: opacity 0.3s ease-in-out; }
    .modal { transition: opacity 0.3s ease-in-out; }
    .chart-container { position: relative; width: 100%; height: 300px; max-height: 40vh; margin-top: 2rem; }
  </style>
</head>
<body class="bg-stone-100 text-stone-800">
  
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>
    <div class="flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="bg-stone-800 text-white w-64 min-h-screen p-4 fixed md:relative transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-30">
            <h1 class="text-2xl font-bold text-amber-400 mb-8 text-center">Sate Maranggi</h1>
            <nav class="flex flex-col space-y-2">
                <a href="#bisnis-plan" class="sidebar-link active flex items-center py-2 px-4 rounded-lg hover:bg-amber-500 transition">
                    <span class="mr-3">üìÑ</span> Bisnis Plan
                </a>
                <a href="#resep" class="sidebar-link flex items-center py-2 px-4 rounded-lg hover:bg-amber-500 transition">
                    <span class="mr-3">üç≤</span> Panduan Resep
                </a>
                <a href="#dashboard" class="sidebar-link flex items-center py-2 px-4 rounded-lg hover:bg-amber-500 transition">
                    <span class="mr-3">üìä</span> Dashboard Penjualan
                </a>
                 <a href="#pre-order" class="sidebar-link flex items-center py-2 px-4 rounded-lg hover:bg-amber-500 transition">
                    <span class="mr-3">üì¶</span> Data Pesanan
                </a>
                <a href="#data-kas" class="sidebar-link flex items-center py-2 px-4 rounded-lg hover:bg-amber-500 transition">
                    <span class="mr-3">üí∞</span> Data Kas
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="flex-1">
            <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-10 shadow-sm flex items-center p-4 md:hidden">
                <button id="menu-btn" class="text-stone-800 mr-4">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
                <h2 id="header-title" class="text-xl font-bold text-amber-600">Bisnis Plan</h2>
            </header>

            <main class="p-6 md:p-8 pb-16">
                <!-- Section: Bisnis Plan -->
                <section id="bisnis-plan" class="content-section active">
                    <h2 class="text-3xl md:text-4xl font-bold mb-6">Rencana Bisnis Strategis</h2>
                    <div class="space-y-8">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-2xl font-bold mb-4">Analisis Menu & Titik Impas (BEP)</h3>
                            <div id="menu-analysis-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Konten Analisis Menu Dibuat oleh JavaScript -->
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-2xl font-bold mb-4">Rincian Modal Awal & Operasional</h3>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <!-- Biaya Investasi -->
                                <div>
                                    <h4 class="text-xl font-semibold mb-3">Biaya Investasi (Sekali Bayar)</h4>
                                    <div id="investment-cost-container" class="space-y-2">
                                        <!-- Diisi oleh JS -->
                                    </div>
                                    <button id="add-investment-btn" class="mt-3 w-full text-sm bg-blue-100 text-blue-800 font-semibold py-2 px-4 rounded-lg hover:bg-blue-200 transition">+ Tambah Biaya Investasi</button>
                                    <div class="flex justify-between font-bold text-lg mt-4 border-t pt-2">
                                        <span>Total Investasi:</span>
                                        <span id="total-investment">Rp 0</span>
                                    </div>
                                </div>
                                <!-- Biaya Operasional -->
                                <div>
                                    <h4 class="text-xl font-semibold mb-3">Biaya Operasional (Bulanan)</h4>
                                    <div id="operational-cost-container" class="space-y-2">
                                        <!-- Diisi oleh JS -->
                                    </div>
                                    <button id="add-operational-btn" class="mt-3 w-full text-sm bg-blue-100 text-blue-800 font-semibold py-2 px-4 rounded-lg hover:bg-blue-200 transition">+ Tambah Biaya Operasional</button>
                                    <div class="flex justify-between font-bold text-lg mt-4 border-t pt-2">
                                        <span>Total Operasional/Bulan:</span>
                                        <span id="total-operational">Rp 0</span>
                                    </div>
                                </div>
                            </div>
                             <div class="mt-8 border-t-2 border-amber-500 pt-4 bg-amber-50 p-4 rounded-lg">
                                <h4 class="text-xl font-bold text-amber-800">Total Modal Keseluruhan</h4>
                                <p class="text-sm text-stone-600">(Total Investasi + 1 Bulan Biaya Operasional)</p>
                                <p id="total-modal-keseluruhan" class="text-3xl font-bold text-amber-600 mt-2">Rp 0</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section: Panduan Resep -->
                <section id="resep" class="content-section">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl md:text-4xl font-bold">Panduan Resep</h2>
                        <button id="add-recipe-btn" class="bg-amber-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-amber-600 transition">+ Tambah Resep</button>
                    </div>
                    <div id="recipe-container" class="space-y-8">
                        <!-- Konten Resep Dibuat oleh JavaScript -->
                    </div>
                </section>

                <!-- Section: Dashboard Penjualan -->
                <section id="dashboard" class="content-section">
                    <h2 class="text-3xl md:text-4xl font-bold mb-6">Dashboard Penjualan</h2>
                    <div class="bg-white p-6 rounded-lg shadow">
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                            <div>
                                <h3 class="text-lg font-semibold text-stone-500 mb-2">Target Capaian Bulanan</h3>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-3xl font-bold text-amber-500">Rp</span>
                                    <input id="target-rupiah" type="text" placeholder="15.000.000" class="text-3xl font-bold text-amber-600 bg-amber-50 w-full focus:outline-none focus:ring-2 focus:ring-amber-300 border-none p-2 pl-12 rounded-lg">
                                </div>
                            </div>
                            <div class="md:border-l md:pl-6">
                                <label for="target-harian" class="font-semibold">Target Penjualan Harian (Porsi)</label>
                                <div class="flex items-center space-x-4 mt-2">
                                    <input id="target-harian" type="range" min="10" max="100" step="1" value="30" class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-amber-500">
                                    <span id="target-harian-value" class="font-bold text-amber-600 text-lg w-24 text-right">30 Porsi</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-6">
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h3 class="text-lg font-semibold text-stone-500 mb-2">Target Pemasukan Bulan Ini</h3>
                            <p id="target-bulanan" class="text-3xl font-bold text-amber-600">Rp 0</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h3 class="text-lg font-semibold text-stone-500 mb-2">Laba Kotor Aktual</h3>
                            <p id="laba-kotor" class="text-3xl font-bold text-blue-600">Rp 0</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h3 class="text-lg font-semibold text-stone-500 mb-2">Laba Bersih Aktual</h3>
                            <p id="laba-bersih" class="text-3xl font-bold text-green-600">Rp 0</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h3 class="text-lg font-semibold text-stone-500 mb-2">Kekurangan Menuju Target</h3>
                            <p id="kekurangan-target" class="text-3xl font-bold text-red-500">Rp 0</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow mt-6">
                        <h3 class="text-xl font-bold mb-4">Tren Pemasukan Harian (Bulan Ini)</h3>
                        <div class="chart-container">
                            <canvas id="sales-trend-chart"></canvas>
                        </div>
                    </div>
                </section>
                
                <!-- Section: Pre-order -->
                <section id="pre-order" class="content-section">
                    <h2 class="text-3xl md:text-4xl font-bold mb-6">Data Pesanan (Pre-order)</h2>
                    <div class="bg-white p-6 rounded-lg shadow mb-8">
                        <h3 class="text-xl font-bold mb-4">Formulir Pesanan Baru</h3>
                        <form id="pre-order-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="po-customer" class="block text-sm font-bold text-stone-700 mb-1">Nama Pemesan</label>
                                    <input type="text" id="po-customer" class="bg-stone-100 w-full rounded p-3" required>
                                </div>
                                <div>
                                    <label for="po-date" class="block text-sm font-bold text-stone-700 mb-1">Tgl Pengambilan</label>
                                    <input type="date" id="po-date" class="bg-stone-100 w-full rounded p-3" required>
                                </div>
                            </div>
                            <div>
                                <label for="po-details" class="block text-sm font-bold text-stone-700 mb-1">Detail Pesanan</label>
                                <textarea id="po-details" rows="3" class="bg-stone-100 w-full rounded p-3" placeholder="Contoh: 5 porsi Sate Sapi, 2 porsi Sate Kambing" required></textarea>
                            </div>
                             <div>
                                <label for="po-amount" class="block text-sm font-bold text-stone-700 mb-1">Total Harga (Rp)</label>
                                <input type="number" id="po-amount" class="bg-stone-100 w-full rounded p-3" required>
                            </div>
                            <button type="submit" class="w-full md:w-auto bg-amber-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-amber-600 transition">Simpan Pesanan</button>
                        </form>
                    </div>
                    <div class="flex justify-center mb-6">
                        <div class="bg-white p-4 rounded-lg shadow inline-flex space-x-6">
                            <div class="text-center">
                                <p class="text-2xl font-bold text-blue-600" id="po-proses">0</p>
                                <p class="text-sm text-stone-500">Dalam Proses</p>
                            </div>
                             <div class="text-center">
                                <p class="text-2xl font-bold text-green-600" id="po-selesai">0</p>
                                <p class="text-sm text-stone-500">Selesai</p>
                            </div>
                        </div>
                    </div>
                    <div id="pre-order-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                         <!-- Diisi oleh JS -->
                    </div>
                </section>

                <!-- Section: Data Kas -->
                <section id="data-kas" class="content-section">
                    <h2 class="text-3xl md:text-4xl font-bold mb-6">Data Kas</h2>
                    <div class="bg-white p-6 rounded-lg shadow mb-8">
                        <h3 class="text-xl font-bold mb-4">Formulir Transaksi</h3>
                        <form id="transaction-form" class="space-y-4">
                            <div>
                                <label for="tx-date" class="block text-sm font-bold text-stone-700 mb-1">Tanggal</label>
                                <input type="date" id="tx-date" class="bg-stone-100 p-3 mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-amber-500 focus:ring-amber-500" required>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="tx-type" class="block text-sm font-bold text-stone-700 mb-1">Jenis</label>
                                    <select id="tx-type" class="bg-stone-100 p-3 mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-amber-500 focus:ring-amber-500">
                                        <option>Pemasukan</option>
                                        <option>Pengeluaran</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="tx-category" class="block text-sm font-bold text-stone-700 mb-1">Kategori</label>
                                    <select id="tx-category" class="bg-stone-100 p-3 mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-amber-500 focus:ring-amber-500"></select>
                                </div>
                            </div>
                            <div>
                                <label for="tx-amount" class="block text-sm font-bold text-stone-700 mb-1">Jumlah (Rp)</label>
                                <input type="number" id="tx-amount" placeholder="50000" class="bg-stone-100 p-3 mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-amber-500 focus:ring-amber-500" required>
                            </div>
                            <button type="submit" class="w-full bg-amber-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-amber-600 transition">Tambah Transaksi</button>
                        </form>
                    </div>
                    <div id="transaction-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Riwayat Transaksi Card-based -->
                    </div>
                </section>
            </main>
        </div>
    </div>
    
    <!-- All Modals -->
    <div id="edit-tx-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-40 hidden items-center justify-center"> <!-- Modal Edit Transaksi --> </div>
    <div id="kelola-menu-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-40 hidden items-center justify-center"> <!-- Modal Kelola Menu --> </div>
    <div id="recipe-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-40 hidden items-center justify-center"> <!-- Modal Resep --> </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
    apiKey: "AIzaSyC_Z8QS_mNbExzIoppP_0EbABM4Y1eeVTQ",
    authDomain: "dasbor-maranggiin.firebaseapp.com",
    projectId: "dasbor-maranggiin",
    storageBucket: "dasbor-maranggiin.firebasestorage.app",
    messagingSenderId: "476865235556",
    appId: "1:476865235556:web:f1dd8a2dfd93c623b1ad71",
    measurementId: "G-QMD7ZLZ20Z"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // === DOM Cache ===
    const DOMElements = {
      txForm: document.getElementById('transaction-form'),
      txDate: document.getElementById('tx-date'),
      txType: document.getElementById('tx-type'),
      txCategory: document.getElementById('tx-category'),
      txAmount: document.getElementById('tx-amount'),
      txList: document.getElementById('transaction-list'),
      preOrderForm: document.getElementById('pre-order-form'),
      preOrderList: document.getElementById('pre-order-list'),
      sidebarLinks: document.querySelectorAll('.sidebar-link'),
      contentSections: document.querySelectorAll('.content-section'),
      menuBtn: document.getElementById('menu-btn'),
      sidebar: document.getElementById('sidebar'),
      sidebarOverlay: document.getElementById('sidebar-overlay'),
      headerTitle: document.getElementById('header-title')
    };

    // === NAVIGATION ===
    function setupNavigation() {
      DOMElements.sidebarLinks.forEach(link => {
        link.addEventListener('click', e => {
          e.preventDefault();
          const targetId = link.getAttribute('href').substring(1);
          DOMElements.contentSections.forEach(sec => sec.classList.remove('active'));
          document.getElementById(targetId).classList.add('active');

          DOMElements.sidebarLinks.forEach(l => l.classList.remove('active'));
          link.classList.add('active');

          DOMElements.headerTitle.textContent = link.textContent.trim();
          if (window.innerWidth < 768) toggleSidebar();
        });
      });

      DOMElements.menuBtn.addEventListener('click', toggleSidebar);
      DOMElements.sidebarOverlay.addEventListener('click', toggleSidebar);
    }

    function toggleSidebar() {
      DOMElements.sidebar.classList.toggle('-translate-x-full');
      DOMElements.sidebarOverlay.classList.toggle('hidden');
    }

    // === TRANSAKSI ===
    let transactions = [];

    async function addTransaction(e) {
      e.preventDefault();
      const tx = {
        date: DOMElements.txDate.value,
        type: DOMElements.txType.value,
        category: DOMElements.txCategory.value,
        amount: parseInt(DOMElements.txAmount.value) || 0
      };
      await addDoc(collection(db, "transactions"), tx);
      await loadTransactions();
      DOMElements.txForm.reset();
    }

    async function loadTransactions() {
      const querySnapshot = await getDocs(collection(db, "transactions"));
      transactions = [];
      querySnapshot.forEach(docSnap => {
        transactions.push({ id: docSnap.id, ...docSnap.data() });
      });
      renderTransactions();
    }

    async function deleteTransaction(id) {
      await deleteDoc(doc(db, "transactions", id));
      await loadTransactions();
    }

    function renderTransactions() {
      DOMElements.txList.innerHTML = '';
      transactions.forEach(tx => {
        const card = document.createElement('div');
        card.className = 'bg-white p-4 rounded-lg shadow';
        card.innerHTML = `
          <p class="font-bold">${tx.date} - ${tx.category}</p>
          <p>${tx.type} : Rp ${tx.amount.toLocaleString()}</p>
          <button class="text-red-500" onclick="deleteTransaction('${tx.id}')">Hapus</button>
        `;
        DOMElements.txList.appendChild(card);
      });
    }

    // === PRE-ORDER ===
    let preOrders = [];

    async function addPreOrder(e) {
      e.preventDefault();
      const order = {
        customer: DOMElements.preOrderForm.querySelector('#po-customer').value,
        date: DOMElements.preOrderForm.querySelector('#po-date').value,
        details: DOMElements.preOrderForm.querySelector('#po-details').value,
        amount: parseInt(DOMElements.preOrderForm.querySelector('#po-amount').value) || 0,
        status: "proses"
      };
      await addDoc(collection(db, "preorders"), order);
      await loadPreOrders();
      DOMElements.preOrderForm.reset();
    }

    async function loadPreOrders() {
      const querySnapshot = await getDocs(collection(db, "preorders"));
      preOrders = [];
      querySnapshot.forEach(docSnap => {
        preOrders.push({ id: docSnap.id, ...docSnap.data() });
      });
      renderPreOrders();
    }

    function renderPreOrders() {
      DOMElements.preOrderList.innerHTML = '';
      preOrders.forEach(po => {
        const card = document.createElement('div');
        card.className = 'bg-white p-4 rounded-lg shadow';
        card.innerHTML = `
          <h4 class="font-bold">${po.customer}</h4>
          <p>${po.details}</p>
          <p>Tgl: ${po.date}</p>
          <p>Total: Rp ${po.amount.toLocaleString()}</p>
          <p>Status: ${po.status}</p>
        `;
        DOMElements.preOrderList.appendChild(card);
      });
    }

    // === INIT ===
    async function initialize() {
      setupNavigation();
      DOMElements.txDate.valueAsDate = new Date();
      DOMElements.preOrderForm.querySelector('#po-date').valueAsDate = new Date();
      
      DOMElements.txForm.addEventListener('submit', addTransaction);
      DOMElements.preOrderForm.addEventListener('submit', addPreOrder);

      await loadTransactions();
      await loadPreOrders();
    }

    initialize();

    // Biar fungsi bisa dipanggil inline onclick
    window.deleteTransaction = deleteTransaction;
  </script>
</body>
</html>
